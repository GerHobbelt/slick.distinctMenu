<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" href="SlickGrid/slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="SlickGrid/plugins/slick.headermenu.css" type="text/css"/>
  <link rel="stylesheet" href="SlickGrid/slick-default-theme.css" type="text/css"/>
  <style>
    /**
     * Style the drop-down menu here since the plugin stylesheet mostly contains structural CSS.
     */

    .slick-header-menu {
      border: 1px solid #718BB7;
      background: #f0f0f0;
      padding: 2px;
      -moz-box-shadow: 2px 2px 2px silver;
      -webkit-box-shadow: 2px 2px 2px silver;
      min-width: 100px;
      z-index: 20;
    }


    .slick-header-menuitem {
      padding: 2px 4px;
      border: 1px solid transparent;
      border-radius: 3px;
    }

    .slick-header-menuitem:hover {
      border-color: silver;
      background: white;
    }

    .slick-header-menuitem-disabled {
      border-color: transparent !important;
      background: inherit !important;
    }

    .icon-help {
      background-image: url(../images/help.png);
    }
  </style>
</head>
<body>
<div style="position:relative">
  <div style="width:600px;">
    <div id="myGrid" style="width:100%;height:500px;"></div>
  </div>

</div>

<script src="SlickGrid/lib/jquery-1.7.min.js"></script>
<script src="SlickGrid/lib/jquery.event.drag-2.2.js"></script>

<script src="SlickGrid/slick.core.js"></script>
<script src="SlickGrid/slick.grid.js"></script>
<script src="SlickGrid/slick.dataView.js"></script>
<script src="SlickGrid/plugins/slick.headermenu.js"></script>
<!-- distinct plugin -->
<script src="../slick.distinctMenu.js"></script>

<script>
  var grid;
  var columns = [
    {id: "title", name: "Title", field: "title"},
    {id: "duration", name: "Duration", field: "duration"},
    {id: "%", name: "% Complete", field: "percentComplete"},
    {id: "start", name: "Start", field: "start"},
    {id: "finish", name: "Finish", field: "finish"},
    {id: "effort-driven", name: "Effort Driven", field: "effortDriven"}
  ];

  var options = {
    enableColumnReorder: false
  };

  $(function () {
    var data = [];
    for (var i = 0; i < 500; i++) {
      data[i] = {
        id: i,
        title: "Task " + i,
        duration: (Math.round(Math.random() * 5))+" days",
        percentComplete: Math.round(Math.random() * 100),
        start: "01/01/2009",
        finish: "01/05/2009",
        effortDriven: (i % 5 == 0)
      };
    }
    var columnFilters = {};

    function filter(item) {
      for(var field in columnFilters)
      {
        if( item!==undefined && item[field]!== columnFilters[field] )
        {
          return false;
        }
      }
      return true;
    }

    var dataView = new Slick.Data.DataView();
    dataView.setItems(data);
    dataView.setFilter(filter);

    grid = new Slick.Grid("#myGrid", dataView, columns, options);
    // Make the grid respond to DataView change events.
    dataView.onRowCountChanged.subscribe(function (e, args) {
      grid.updateRowCount();
      grid.render();
    });

    dataView.onRowsChanged.subscribe(function (e, args) {
      grid.invalidateRows(args.rows);
      grid.render();
    });
    var headerMenuPlugin = new Slick.Plugins.HeaderMenu({});
    grid.registerPlugin(headerMenuPlugin);

    /**                                                   */
    /** TTHERE IS ALL MAGIC STUFF RELATED TO DISTINCTMENU */
    /**                                                   */
    var distinctMenuPlugin = new Slick.Plugins.DistinctMenu(
    { headerMenu: headerMenuPlugin,
      columns: columns,
      exclude: ['title', 'start', 'finish'], //columns id which is not used while distinct valuse
      url: '/items',

      // For demo purpose we overwrite doUrl function with this one.
      // This doUrl can be used to generate special url where
      // distinct values can be fetched.
      // By default url is generated like: /items?t=distinct&field=<field>&q=<conditions>
      doUrl: function(field, condition){
        //fetch new data from backend....
        return '/data/distinct/'+field+'.json';
      },

      // for demo purpose we overwrite getDistinct function with this one
      // This just get distinct data from rows.
      // Normally this list is fetched from backend by $.getJSON(url) function
      getDistinct: function(field, url, urlParameters, callback){
        console.log('getDistinct');
        function getDist(field){
          var i=0,list = [];
          data.forEach( function(row){
            if( row[field] && list.indexOf( row[field] )== -1 ){
              list.push( row[field] );
            }
          });
          return list;
        }
        callback(null,  getDist(field)); 
      },
      // there we fetch actual data
      // This is currently not implemented to distinct itself,
      // so you need to do it yourself. Normally we should
      // fetch data from back-end (ajax) but now for demo purpose
      // we skip that part and filter just dataView.
      doFilter: function(field, condition){
        console.log('doFilter');
        columnFilters = {};
        for(var i=0;condition['$and'] && i<condition['$and'].length;i++){
          for(var key in condition['$and'][i] ){
            columnFilters[key] = condition['$and'][i][key];
          };
        }
        //columnFilters[field] = 3;
        dataView.refresh();
        distinctMenuPlugin.update();
      }
    }
  );
  //Finally register plugin
  grid.registerPlugin(distinctMenuPlugin);
  //and update menu items
  distinctMenuPlugin.update();
  /**                                                   */
  /**                MAGIC END                          */
  /**                                                   */

  })
</script>
</body>
</html>