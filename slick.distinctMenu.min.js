!function(n){function e(e){function i(i){e=n.extend(!0,{},p,e),y=i,o(!1),e.headerMenu.onCommand.subscribe(c),console.log("distinctMenu initialized")}function o(n,i,o){function c(n){var e={$and:n.$and.filter(function(n){return 0!=Object.keys(n).length})};return"[]"==JSON.stringify(e.$and)?{}:e}var r=-1;if("string"==typeof n&&"object"==typeof i?r=t(n):"object"==typeof n&&(r=e.columns.length,o=i,i=n,n=!0),n===!1){e.condition.$and=[];for(var l=0;l<=e.columns.length;l++)e.condition.$and.push({})}else if(i)if(o){if(!e.condition.$and[r].$or){var d=JSON.stringify(e.condition.$and[r]);e.condition.$and[r]={},e.condition.$and[r].$or=[JSON.parse(d)]}e.condition.$and[r].$or.push(i)}else e.condition.$and[r]=i;var u=c(e.condition);return u}function t(n){var i;for(i=0;i<e.columns.length;i++)if(e.columns[i].field==n)return i}function c(n,i){i.command==e.command?(l(i.column,i.item,n.ctrlKey),o(i.column.field,i.item.condition,n.ctrlKey),e.doFilter(i.column.field,o())):"filter"==i.command&&(l(i.column,i.item,n.ctrlKey),o(i.column.field,i.item.condition,n.ctrlKey),e.doFilter(i.column.field,o()))}function r(){v.unsubscribeAll(),console.log("distinctMenu destroyed")}function l(i,o,t){n.extend(!0,i,{header:{menu:{items:[]}}});for(var c=!1,r=0;r<i.header.menu.items.length;r++){var l=i.header.menu.items[r];l.command==e.command&&(l.title===o.title?(l.iconImage=e.selectIcon,"All"!==l.title&&(c=!0)):t||(l.iconImage=!1))}c&&(console.log("filtering is in use"),i.iconImage=e.filterIcon)}function d(n){y.setColumns(n),y.render(),console.log("ready")}function u(n,i){"object"==typeof i&&(i=JSON.stringify(i));var o=e.url+"?t=distinct&f="+n;return i&&(o+="&q="+i),o}function m(n,e){var i={};return i[n]=e,i}function a(e,i,o,t){n.getJSON(i,o).done(function(n){"object"==typeof n?t(null,n):t("invalid response format")}).fail(function(n,e,i){t(e+", "+i)})}function s(){$(e.columns,0,e.onReady)}function f(n,e){console.log("Filteringing with condition: "+JSON.stringify(e))}function g(n,e,i){return n.filter(function(n){return n[e]!==i})}function h(i,o,t){n.extend(!0,e.columns[i],{header:{menu:{items:[]}}});var c=e.columns[i].header.menu.items;e.columns[i].header.menu.items=g(c,"command",e.command);var c=e.columns[i].header.menu.items;c.push({command:e.command,title:"All",condition:{},iconImage:e.selectIcon}),t.forEach(function(n){c.push({command:e.command,title:n,condition:e.doCondition(o.field,n)})})}var y,v=new Slick.EventHandler,p={command:"filter",headerMenu:!1,columns:[],url:"/items",urlParameters:null,exclude:[],doUrl:u,doCondition:m,doFilter:f,getDistinct:a,onReady:d,selectIcon:"SlickGrid/images/tick.png",filterIcon:"SlickGrid/images/bullet_star.png",condition:{$and:[]}},$=function(n,i,t){if(i<n.length){if(e.exclude.indexOf(n[i].id)>=0||"<"===n[i].name[0])return $(n,i+1,t),void 0;var c=!1;if("function"!=typeof e.doUrl)return console.error("doUrl function missing!"),void 0;c=e.doUrl(n[i].field,o()),e.getDistinct(n[i].field,c,e.urlParameters,function(e,o){e?console.error(e):h(i,n[i],o),$(n,i+1,t)})}else t(e.columns)};n.extend(this,{init:i,destroy:r,update:s,condition:o})}n.extend(!0,window,{Slick:{Plugins:{DistinctMenu:e}}})}(jQuery);